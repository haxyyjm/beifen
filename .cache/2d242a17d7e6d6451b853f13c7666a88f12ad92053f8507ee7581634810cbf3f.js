{"source":"webpackJsonp([106],{MdyL:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var r=a(\"BO1k\"),_=a.n(r),s=a(\"PJh5\"),l=a.n(s),i=a(\"mtWM\"),c=a.n(i),n={name:\"integral\",data:function(){return{UrLHeader:\"http://47.98.113.173:9102/v1/\",tableData:[],checked:!0,SearchContent:\"\",param:{},showAdd:!1,showDeleteAndEdit:!1,rowId:\"\",treeData:[],value1:\"\",currentPage:1,pagesize:10,total:0,str_before:\"\",str_after:\"\",card_type:\"\",card_level:\"\",defaultProps:{children:\"children\",label:\"descript\"},custom_wayArr:[{code:\"point\",descript:\"积分\"},{code:\"money\",descript:\"现金\"}],idCodeArr:[]}},created:function(){this.getTreeData()},methods:{handleNodeClick:function(e){this.showAdd=!0,this.showDeleteAndEdit=!1,this.param={};var t=e.card_type,a=e.card_level;this.card_type=t,this.card_level=a,null!=t&&null!=a&&this.getData(this.currentPage,t,a)},handleSizeChange:function(){},getTreeData:function(){var m=this,e=this.UrLHeader+\"customer/member/get_card_setting_tree/?code_type=CM\";c.a.get(e).then(function(e){var t=e.data.data.results,a=!0,r=!1,s=void 0;try{for(var l,i=_()(t);!(a=(l=i.next()).done);a=!0){var c=l.value,n=!0,p=!1,d=void 0;try{for(var o,u=_()(c.children);!(n=(o=u.next()).done);n=!0){var v=o.value;v.card_type=c.code,v.card_level=v.code}}catch(e){p=!0,d=e}finally{try{!n&&u.return&&u.return()}finally{if(p)throw d}}}}catch(e){r=!0,s=e}finally{try{!a&&i.return&&i.return()}finally{if(r)throw s}}m.treeData=e.data.data.results}).catch(function(e){})},getData:function(e,t,a){var r=this,s=r.UrLHeader+\"customer/member/get_card_point_rule_list/\";c()({method:\"get\",url:s,params:{page:e,page_size:8,card_type:t,card_level:a}}).then(function(e){\"success\"==e.data.message?(r.tableData=e.data.data.results,r.total=e.data.data.count):r.$message.error(\"获取数据失败，请重试\")}).catch(function(e){})},handleInfoById:function(e){var t=this;t.showDeleteAndEdit=!0,t.showAdd=!1,t.rowId=e.id;var a=t.UrLHeader+\"customer/member/get_card_point_rule_info/\"+e.id+\"/\";c.a.get(a).then(function(e){\"success\"==e.data.message?(t.param=e.data.data,t.getString(t.param.rate,\":\"),t.param.rate_1=t.str_before,t.param.rate_2=t.str_after,t.param.create_datetime=l()().format(\"YYYY-MM-DD HH:mm:ss\"),t.param.modify_datetime=l()().format(\"YYYY-MM-DD HH:mm:ss\")):t.$message.error(\"获取数据失败，请重试\")})},getString:function(e,t){this.str_before=e.split(t)[0],this.str_after=void 0===e.split(t)[1]?\"\":e.split(t)[1]},handleEdit:function(){var t=this;if(this.validateData()){var e=this.rowId,a=this.UrLHeader+\"customer/member/update_card_point_rule/\"+e+\"/\",r=this;r.param.rate=r.param.rate_1+\":\"+r.param.rate_2,c.a.post(a,r.param).then(function(e){\"success\"==e.data.message?(r.getData(r.currentPage,r.card_type,r.card_level),r.$message({message:\"保存信息成功\",type:\"success\"}),r.showDeleteAndEdit=!1,r.showAdd=!0,r.param={}):t.$message.error(\"保存信息失败\")})}},handleDelete:function(){var t=this,e=t.rowId,a=t.UrLHeader+\"customer/member/remove_card_point_rule/\"+e+\"/\";t.$confirm(\"是否进行删除操作?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){c.a.post(a).then(function(){t.getData(t.currentPage,t.card_type,t.card_level),t.$message({message:\"删除成功\",type:\"success\"}),t.showDeleteAndEdit=!1,t.showAdd=!0,t.param={}}).catch(function(e){t.$message.error(\"删除失败!\")})}).catch(function(){t.$message({type:\"info\",message:\"已取消删除\"})})},handleAdd:function(){var t=this;if(void 0!==this.card_type&&void 0!==this.card_level){if(this.validateData()){var a=this,e=a.UrLHeader+\"customer/member/add_card_point_rule/\";a.param.card_type=a.card_type,a.param.card_level=a.card_level,a.param.rate=a.param.rate_1+\":\"+a.param.rate_2,c.a.post(e,a.param).then(function(e){a.getData(a.currentPage,a.card_type,a.card_level),a.$message({message:\"添加成功\",type:\"success\"}),a.param={}}).catch(function(e){t.$message.error(\"添加数据失败\")})}}else this.$message({message:\"请点击具体子节点在进行添加!\",type:\"warning\"})},validateData:function(){return this.validateBlank(this.param.code,\"代码是必填项\",this)&&this.validateBlank(this.param.descript,\"中文描述是必填项\",this)&&this.validateBlank(this.param.descript_en,\"英文描述是必填项\",this)&&this.validateBlank(this.param.rate_1,\"积分比例是必填项\",this)&&this.validateBlank(this.param.rate_2,\"积分比例是必填项\",this)&&this.validateNAN(this.param.rate_1,\"积分比例是数字\",this)&&this.validateNAN(this.param.rate_2,\"积分比例是数字\",this)},validateBlank:function(e,t,a,r){return t?\"\"===e||null==e?(a.$message({message:t,type:\"error\"}),!1):(r&&a.$message({message:r,type:\"success\"}),!0):!(\"\"===e||null==e)},validateNAN:function(e,t,a,r){if(\"\"===e||null==e)return!0;var s=/^(\\-|\\+)?\\d+(\\.\\d+)?$/;return t?s.test(e)?(r&&a.$message({message:r,type:\"success\"}),!0):(a.$message({message:t,type:\"error\"}),!1):s.test(e)}}},p={render:function(){var t=this,e=t.$createElement,a=t._self._c||e;return a(\"div\",{staticClass:\"integral\"},[a(\"div\",{staticClass:\"tableShow\"},[a(\"div\",{staticClass:\"leftShow pull-left\"},[a(\"el-tree\",{ref:\"tree\",staticStyle:{background:\"#f7f7f7\"},attrs:{data:t.treeData,props:t.defaultProps},on:{\"node-click\":t.handleNodeClick}})],1),t._v(\" \"),a(\"div\",{staticClass:\"table pull-right\",staticStyle:{width:\"75%\"}},[a(\"el-table\",{staticStyle:{width:\"100%\"},attrs:{data:t.tableData,\"header-cell-style\":{background:\"#BFCAD1\",color:\"#68819E\"}},on:{\"row-click\":t.handleInfoById}},[a(\"el-table-column\",{attrs:{type:\"index\",width:\"55\",label:\"编号\"}}),t._v(\" \"),a(\"el-table-column\",{attrs:{prop:\"code\",label:\"积分规则代码\"}}),t._v(\" \"),a(\"el-table-column\",{attrs:{prop:\"descript\",label:\"中文描述\"}}),t._v(\" \"),a(\"el-table-column\",{attrs:{prop:\"descript_en\",label:\"英文描述\"}}),t._v(\" \"),a(\"el-table-column\",{attrs:{prop:\"rate\",label:\"积分比例\"}})],1),t._v(\" \"),a(\"el-pagination\",{attrs:{\"current-page\":t.currentPage,\"page-size\":t.pagesize,layout:\"total, prev, pager, next, jumper\",total:t.total},on:{\"size-change\":t.handleSizeChange,\"current-change\":t.getData}})],1)]),t._v(\" \"),a(\"p\",{staticClass:\"iconLogo\"},[t._v(\"协议公司-VIP 级别\")]),t._v(\" \"),a(\"div\",{staticClass:\"classDiv\"},[a(\"div\",{staticClass:\"classCell\"},[a(\"div\",{staticClass:\"inputCell\"},[a(\"p\",[t._v(\"代码：\")]),t._v(\" \"),a(\"el-input\",{staticStyle:{width:\"400px\"},attrs:{placeholder:\"请输入内容\"},model:{value:t.param.code,callback:function(e){t.$set(t.param,\"code\",e)},expression:\"param.code\"}})],1),t._v(\" \"),a(\"div\",{staticClass:\"inputCell\"},[a(\"p\",[t._v(\"中文描述 ：\")]),t._v(\" \"),a(\"el-input\",{staticStyle:{width:\"400px\"},attrs:{placeholder:\"请输入内容\"},model:{value:t.param.descript,callback:function(e){t.$set(t.param,\"descript\",e)},expression:\"param.descript\"}})],1),t._v(\" \"),a(\"div\",{staticClass:\"inputCell\"},[a(\"p\",[t._v(\"英文描述：\")]),t._v(\" \"),a(\"el-input\",{staticStyle:{width:\"400px\"},attrs:{placeholder:\"请输入内容\"},model:{value:t.param.descript_en,callback:function(e){t.$set(t.param,\"descript_en\",e)},expression:\"param.descript_en\"}})],1),t._v(\" \"),a(\"div\",{staticClass:\"inputCell\"},[a(\"p\",[t._v(\"积分比例：\")]),t._v(\" \"),a(\"el-input\",{staticStyle:{width:\"190px\"},attrs:{placeholder:\"请输入内容\"},model:{value:t.param.rate_1,callback:function(e){t.$set(t.param,\"rate_1\",\"string\"==typeof e?e.trim():e)},expression:\"param.rate_1\"}}),t._v(\" \"),a(\"span\",{staticStyle:{\"margin-left\":\"4px\",\"margin-right\":\"4px\"}},[t._v(\":\")]),t._v(\" \"),a(\"el-input\",{staticStyle:{width:\"190px\"},attrs:{placeholder:\"请输入内容\"},model:{value:t.param.rate_2,callback:function(e){t.$set(t.param,\"rate_2\",\"string\"==typeof e?e.trim():e)},expression:\"param.rate_2\"}})],1),t._v(\" \"),a(\"div\",{staticClass:\"inputCell\"},[a(\"p\",[t._v(\"起步金额：\")]),t._v(\" \"),a(\"el-input\",{staticStyle:{width:\"400px\"},attrs:{placeholder:\"请输入内容\"},model:{value:t.param.base,callback:function(e){t.$set(t.param,\"base\",e)},expression:\"param.base\"}})],1),t._v(\" \"),a(\"div\",{staticClass:\"inputCell\"},[a(\"p\",[t._v(\"消费酒店：\")]),t._v(\" \"),a(\"el-input\",{staticStyle:{width:\"400px\"},attrs:{placeholder:\"请输入内容\"},model:{value:t.param.consume_hotel,callback:function(e){t.$set(t.param,\"consume_hotel\",e)},expression:\"param.consume_hotel\"}})],1),t._v(\" \"),a(\"div\",{staticClass:\"inputCell\"},[a(\"p\",[t._v(\"来源：\")]),t._v(\" \"),a(\"el-input\",{staticStyle:{width:\"400px\"},attrs:{placeholder:\"请输入内容\"},model:{value:t.param.src,callback:function(e){t.$set(t.param,\"src\",e)},expression:\"param.src\"}})],1),t._v(\" \"),a(\"div\",{staticClass:\"inputCell\"},[a(\"p\",[t._v(\"渠道：\")]),t._v(\" \"),a(\"el-input\",{staticStyle:{width:\"400px\"},attrs:{placeholder:\"请输入内容\"},model:{value:t.param.channel,callback:function(e){t.$set(t.param,\"channel\",e)},expression:\"param.channel\"}})],1),t._v(\" \"),a(\"div\",{staticClass:\"inputCell\"},[a(\"p\",[t._v(\"房价码：\")]),t._v(\" \"),a(\"el-input\",{staticStyle:{width:\"400px\"},attrs:{placeholder:\"请输入内容\"},model:{value:t.param.rate_code,callback:function(e){t.$set(t.param,\"rate_code\",e)},expression:\"param.rate_code\"}})],1),t._v(\" \"),a(\"div\",{staticClass:\"inputCell\"},[a(\"p\",[t._v(\"费用类别：\")]),t._v(\" \"),a(\"el-input\",{staticStyle:{width:\"400px\"},attrs:{placeholder:\"请输入内容\"},model:{value:t.param.fee_code,callback:function(e){t.$set(t.param,\"fee_code\",e)},expression:\"param.fee_code\"}})],1)]),t._v(\" \"),a(\"div\",{staticClass:\"classCell\"},[a(\"div\",{staticClass:\"inputCell\"},[a(\"p\",[t._v(\"账务发生日期：\")]),t._v(\" \"),a(\"el-date-picker\",{staticStyle:{width:\"400px\"},attrs:{type:\"date\",placeholder:\"选择日期\"},model:{value:t.value1,callback:function(e){t.value1=e},expression:\"value1\"}})],1),t._v(\" \"),a(\"div\",{staticClass:\"inputCell\"},[a(\"p\",[t._v(\"有效期起：\")]),t._v(\" \"),a(\"el-date-picker\",{staticStyle:{width:\"400px\"},attrs:{type:\"date\",placeholder:\"选择日期\"},model:{value:t.param.date_begin,callback:function(e){t.$set(t.param,\"date_begin\",e)},expression:\"param.date_begin\"}})],1),t._v(\" \"),a(\"div\",{staticClass:\"inputCell\"},[a(\"p\",[t._v(\"有效期止：\")]),t._v(\" \"),a(\"el-date-picker\",{staticStyle:{width:\"400px\"},attrs:{type:\"date\",placeholder:\"选择日期\"},model:{value:t.param.date_end,callback:function(e){t.$set(t.param,\"date_end\",e)},expression:\"param.date_end\"}})],1),t._v(\" \"),a(\"div\",{staticClass:\"inputCell\"},[a(\"p\",[t._v(\"截断方式：\")]),t._v(\" \"),a(\"el-input\",{staticStyle:{width:\"400px\"},attrs:{placeholder:\"请输入内容\"},model:{value:t.param.truncate,callback:function(e){t.$set(t.param,\"truncate\",e)},expression:\"param.truncate\"}})],1),t._v(\" \"),a(\"div\",{staticClass:\"inputCell\"},[a(\"p\",[t._v(\"开卡酒店：\")]),t._v(\" \"),a(\"el-input\",{staticStyle:{width:\"400px\"},attrs:{placeholder:\"请输入内容\"},model:{value:t.param.card_produce_hotel,callback:function(e){t.$set(t.param,\"card_produce_hotel\",e)},expression:\"param.card_produce_hotel\"}})],1),t._v(\" \"),a(\"div\",{staticClass:\"inputCell\"},[a(\"p\",[t._v(\"消费日期：\")]),t._v(\" \"),a(\"el-date-picker\",{staticStyle:{width:\"400px\"},attrs:{type:\"date\",placeholder:\"选择日期\"},model:{value:t.value1,callback:function(e){t.value1=e},expression:\"value1\"}})],1),t._v(\" \"),a(\"div\",{staticClass:\"inputCell\"},[a(\"p\",[t._v(\"市场：\")]),t._v(\" \"),a(\"el-input\",{staticStyle:{width:\"400px\"},attrs:{placeholder:\"请输入内容\"},model:{value:t.param.market,callback:function(e){t.$set(t.param,\"market\",e)},expression:\"param.market\"}})],1),t._v(\" \"),a(\"div\",{staticClass:\"inputCell\"},[a(\"p\",[t._v(\"预订渠道：\")]),t._v(\" \"),a(\"el-input\",{staticStyle:{width:\"400px\"},attrs:{placeholder:\"请输入内容\"},model:{value:t.param.rsv_type,callback:function(e){t.$set(t.param,\"rsv_type\",e)},expression:\"param.rsv_type\"}})],1),t._v(\" \"),a(\"div\",{staticClass:\"inputCell\"},[a(\"p\",[t._v(\"房类：\")]),t._v(\" \"),a(\"el-select\",{staticStyle:{width:\"400px\"},model:{value:t.param.room_type,callback:function(e){t.$set(t.param,\"room_type\",e)},expression:\"param.room_type\"}},t._l(t.idCodeArr,function(e,t){return a(\"el-option\",{key:t,attrs:{label:e.descript,value:e.code}})}),1)],1),t._v(\" \"),a(\"div\",{staticClass:\"inputCell\"},[a(\"p\",[t._v(\"付款码：\")]),t._v(\" \"),a(\"el-input\",{staticStyle:{width:\"400px\"},attrs:{placeholder:\"请输入内容\"},model:{value:t.param.pay_code,callback:function(e){t.$set(t.param,\"pay_code\",e)},expression:\"param.pay_code\"}})],1)]),t._v(\" \"),a(\"div\",{staticClass:\"classCell pull-right\",staticStyle:{width:\"15%\",\"margin-top\":\"5%\"}},[a(\"p\",{staticClass:\"cellp\"},[t._v(\"创建人:\"+t._s(t.param.create_user))]),t._v(\" \"),a(\"p\",{staticClass:\"cellp\"},[t._v(\"创建日期:\"+t._s(t.param.create_datetime))]),t._v(\" \"),a(\"p\",{staticClass:\"cellp\"},[t._v(\"修改人:\"+t._s(t.param.modify_user))]),t._v(\" \"),a(\"p\",{staticClass:\"cellp\"},[t._v(\"修改日期:\"+t._s(t.param.modify_datetime))]),t._v(\" \"),a(\"div\",[a(\"el-button\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.showAdd,expression:\"showAdd\"}],attrs:{type:\"primary\"},on:{click:function(e){return t.handleAdd()}}},[t._v(\"添加\")]),t._v(\" \"),a(\"el-button\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.showDeleteAndEdit,expression:\"showDeleteAndEdit\"}],attrs:{type:\"primary\"},on:{click:function(e){return t.handleDelete()}}},[t._v(\"删除\")]),t._v(\" \"),a(\"el-button\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.showDeleteAndEdit,expression:\"showDeleteAndEdit\"}],attrs:{type:\"primary\"},on:{click:function(e){return t.handleEdit()}}},[t._v(\"保存\")])],1)])])])},staticRenderFns:[]};var d=a(\"VU/8\")(n,p,!1,function(e){a(\"m8T7\")},\"data-v-4f9adfc6\",null);t.default=d.exports},m8T7:function(e,t){}});"}