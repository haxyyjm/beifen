{"source":"webpackJsonp([67],{\"+bZw\":function(e,t){},\"/ZA0\":function(e,t,r){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var i=r(\"mtWM\"),o=r.n(i),a={name:\"saleRules\",data:function(){return{outerVisible:!1,CardLevelList:[{code:\"code\",descript:\"descript\",descript_en:\"descript_en\",is_halt:0},{code:\"code\",descript:\"descript\",descript_en:\"descript_en\",is_halt:0},{code:\"code\",descript:\"descript\",descript_en:\"descript_en\",is_halt:0},{code:\"code\",descript:\"descript\",descript_en:\"descript_en\",is_halt:0},{code:\"code\",descript:\"descript\",descript_en:\"descript_en\",is_halt:0},{code:\"code\",descript:\"descript\",descript_en:\"descript_en\",is_halt:0},{code:\"code\",descript:\"descript\",descript_en:\"descript_en\",is_halt:0},{code:\"code\",descript:\"descript\",descript_en:\"descript_en\",is_halt:0},{code:\"code\",descript:\"descript\",descript_en:\"descript_en\",is_halt:0},{code:\"code\",descript:\"descript\",descript_en:\"descript_en\",is_halt:0}],UrLHeader:\"http://47.98.113.173:9102/v1/\",SelectUrLHeader:\"http://47.98.113.173:9103/\",currentPage:1,pagesize:10,total:0,promotionList:[],sort:\"\",CertainPromotion:{code_type:\"CM\",code:\" \",descript:\" \",descript_en:\" \",remark:null,date_begin:\" \",date_end:\" \",card_type:\"\",card_level:null,hotel:null,trigger_way:\"\",target_way:\"\",target_member:\"\",target_number:0,point_end_datetime:null,is_only_once:null,is_halt:\"0\",create_user:\"tom\"},salesNewadd:!1,CardTypeTree:[],CardLevelTree:[],trigger_wayArr:[{code:\"night_audit\",descript:\"每天夜审时\"},{code:\"check_in\",descript:\"客房登记入住时\"},{code:\"birthday\",descript:\"会员生日时\"},{code:\"login_in\",descript:\"会员登录时\"},{code:\"upgrade\",descript:\"会员升级时\"},{code:\"evaluation\",descript:\"会员网站评价时\"},{code:\"sing_in\",descript:\"会员网站签到时\"},{code:\"card_charge\",descript:\"储值卡充值时\"},{code:\"room_check_out\",descript:\"客房结账时\"},{code:\"register_card\",descript:\"注册会员成功时\"}],target_wayArr:[{code:\"point\",descript:\"积分\"},{code:\"money\",descript:\"储值\"}],target_memberArr:[{code:\"self\",descript:\"本人\"},{code:\"referrer\",descript:\"推荐人\"}]}},created:function(){this.get_card_type_tree(),this.handleCurrentPageChange(this.currentPage)},methods:{showFunc:function(){this.outerVisible=!this.outerVisible},get_card_promotion_list:function(){this.handleCurrentPageChange(this.currentPage)},get_card_promotion_info:function(e){var a=this,t=a.UrLHeader+\"customer/member/get_card_promotion_info/\"+e+\"/\";a.outerVisible=!0,a.salesNewadd=!1,o.a.get(t).then(function(e){for(var t in a.CertainPromotion=e.data.data,a.target_memberArr)a.CertainPromotion.target_member==a.target_memberArr[t].code&&(a.CertainPromotion.target_member=a.target_memberArr[t].descript);for(var r in a.CardTypeTree)if(a.CertainPromotion.card_type==a.CardTypeTree[r].code)for(var i in a.CertainPromotion.card_type=a.CardTypeTree[r].descript,a.CardTypeTree[r].children)(a.CertainPromotion.card_level=a.CardTypeTree[r].children[i].code)&&(a.CertainPromotion.card_level=a.CardTypeTree[r].children[i].descript)}).catch(function(e){console.info(e)})},NewAddRules:function(){var e=this;e.showFunc(),e.salesNewadd=!0,e.CertainPromotion={code_type:\"CM\",code:\" \",descript:\" \",descript_en:\" \",remark:null,date_begin:new Date,date_end:new Date,card_type:\" \",card_level:\" \",hotel:null,trigger_way:\"\",target_way:\"\",target_member:\"\",target_number:0,point_end_datetime:null,is_only_once:null,is_halt:\"0\",create_user:\"tom\"}},add_card_base:function(){var t=this,e=this.UrLHeader+\"customer/member/add_card_promotion/\";o.a.post(e,t.CertainPromotion).then(function(e){\"success\"==e.data.message?(t.$message({message:\"保存成功\",type:\"success\"}),t.handleCurrentPageChange(t.currentPage)):this.$message.error(\"保存信息失败\")}).catch(function(e){})},update_card_promotion_info:function(e){var t=this,r=this.UrLHeader+\"customer/member/update_card_promotion/\"+e+\"/\";for(var i in t.target_memberArr)t.CertainPromotion.target_member==t.target_memberArr[i].descript&&(t.CertainPromotion.target_member=t.target_memberArr[i].code);for(var a in t.CardTypeTree)if(t.CertainPromotion.card_type==t.CardTypeTree[a].descript)for(var n in t.CertainPromotion.card_type=t.CardTypeTree[a].code,t.CardTypeTree[a].children)(t.CertainPromotion.card_level=t.CardTypeTree[a].children[n].descript)&&(t.CertainPromotion.card_level=t.CardTypeTree[a].children[n].code);t.isnull(t.CertainPromotion.code)||t.isnull(t.CertainPromotion.descript)||t.isnull(t.CertainPromotion.descript_en)||t.isnull(t.CertainPromotion.remark)||t.isnull(t.CertainPromotion.date_begin)||t.isnull(t.CertainPromotion.date_end)||t.isnull(t.CertainPromotion.card_type)||t.isnull(t.CertainPromotion.card_level)?t.$message.error(\"带*项不能为空\"):o.a.post(r,t.CertainPromotion).then(function(e){\"success\"==e.data.message?(t.$message({message:\"保存成功\",type:\"success\"}),t.handleCurrentPageChange(t.currentPage),t.get_card_promotion_info(t.CertainPromotion.id)):this.$message.error(\"保存信息失败\")}).catch(function(e){})},remove_card_promotion_info:function(e){var t=this.UrLHeader+\"customer/member/remove_card_promotion/\"+e+\"/\",r=this;r.$confirm(\"是否永久该删除促销规则?\",\"提示\",{confirmButtonText:\"确定\",cancelButtonText:\"取消\",type:\"warning\"}).then(function(){o.a.post(t).then(function(e){\"success\"==e.data.message?(r.showFunc(),r.handleCurrentPageChange(r.currentPage),r.$message({message:\"删除成功\",type:\"success\"})):this.$message.error(\"保存信息失败\")}).catch(function(e){})}).catch(function(){r.$message({type:\"info\",message:\"已取消删除\"})})},handleCurrentPageChange:function(e){var n=this,t=n.UrLHeader+\"customer/member/get_card_promotion_list/?code_type=CM\";o()({method:\"get\",url:t,params:{page:e,page_size:10}}).then(function(e){for(var t in n.promotionList=e.data.data.results,n.total=e.data.data.count,n.promotionList){for(var r in n.target_memberArr)n.promotionList[t].target_member==n.target_memberArr[r].code&&(n.promotionList[t].target_member=n.target_memberArr[r].descript);for(var i in n.CardTypeTree)if(n.promotionList[t].card_type==n.CardTypeTree[i].code)for(var a in n.promotionList[t].card_type=n.CardTypeTree[i].descript,n.CardTypeTree[i].children)(n.promotionList[t].card_level=n.CardTypeTree[i].children[a].code)&&(n.promotionList[t].card_level=n.CardTypeTree[i].children[a].descript)}}).catch(function(e){console.info(e)})},get_card_type_tree:function(){var e=this.UrLHeader+\"customer/member/get_card_setting_tree/?code_type=CM\",t=this;o.a.get(e).then(function(e){\"success\"==e.data.message?t.CardTypeTree=e.data.data.results:t.$message.error(\"请求服务器失败，稍后重试\")}).catch(function(e){})},get_card_level_tree:function(){var e=this;if(e.CardTypeTree.length)for(var t in e.CardTypeTree)e.CertainPromotion.card_type==e.CardTypeTree[t].code&&(e.CardLevelTree=e.CardTypeTree[t].children);else e.$message({message:\"请先选择协议单位计划\",type:\"warning\"})},isnull:function(e){var t=e.replace(/(^\\s*)|(\\s*$)/g,\"\");return\"\"==t||null==t||null==t}}},n={render:function(){var r=this,e=r.$createElement,i=r._self._c||e;return i(\"div\",{staticClass:\"saleRules\"},[i(\"div\",{staticClass:\"btn-group\"},[i(\"div\",{staticClass:\"single-btn\",on:{click:function(e){return r.NewAddRules()}}},[r._v(\"新增\")])]),r._v(\" \"),i(\"div\",{staticClass:\"table\"},[i(\"table\",{staticStyle:{width:\"100%\"}},[r._m(0),r._v(\" \"),i(\"tbody\",r._l(r.promotionList,function(t,e){return i(\"tr\",{key:e,on:{click:function(e){return r.get_card_promotion_info(t.id)}}},[i(\"td\",[r._v(r._s(e+1))]),r._v(\" \"),i(\"td\",[r._v(r._s(t.code))]),r._v(\" \"),i(\"td\",[r._v(r._s(t.descript))]),r._v(\" \"),i(\"td\",[r._v(r._s(t.date_begin))]),r._v(\" \"),i(\"td\",[r._v(r._s(t.date_end))]),r._v(\" \"),i(\"td\",[r._v(r._s(t.card_type))]),r._v(\" \"),i(\"td\",[r._v(r._s(t.card_level))]),r._v(\" \"),i(\"td\",[r._v(r._s(t.trigger_way))]),r._v(\" \"),i(\"td\",[r._v(r._s(t.target_way))]),r._v(\" \"),i(\"td\",[r._v(r._s(t.target_number))]),r._v(\" \"),i(\"td\",[t.is_halt?i(\"p\",[r._v(\"是\")]):i(\"p\",[r._v(\"否\")])]),r._v(\" \"),i(\"td\",[r._v(r._s(t.descript_en))]),r._v(\" \"),i(\"td\",[r._v(r._s(t.target_member))]),r._v(\" \"),i(\"td\",[r._v(r._s(t.modify_datetime))])])}),0)]),r._v(\" \"),0==r.total?i(\"p\",{staticStyle:{padding:\"20px 0\",\"text-align\":\"center\"}},[r._v(\"当前暂无数据\")]):r._e(),r._v(\" \"),i(\"div\",{staticClass:\"pagination\"},[i(\"el-pagination\",{attrs:{\"current-page\":r.currentPage,\"page-size\":r.pagesize,layout:\"total, prev, pager, next, jumper\",total:r.total},on:{\"current-change\":r.handleCurrentPageChange}})],1)]),r._v(\" \"),i(\"el-dialog\",{attrs:{title:\"促销规则定义\",visible:r.outerVisible},on:{\"update:visible\":function(e){r.outerVisible=e}}},[i(\"div\",{staticClass:\"outdialog\"},[i(\"div\",{staticClass:\"innerbox\"},[i(\"div\",{staticClass:\"inner pull-left\"},[i(\"p\",[r._v(\"代码：\"),i(\"i\",{staticClass:\"red\"},[r._v(\"*\")])]),r._v(\" \"),i(\"el-input\",{staticStyle:{width:\"70%\"},attrs:{placeholder:\"请输入内容\"},model:{value:r.CertainPromotion.code,callback:function(e){r.$set(r.CertainPromotion,\"code\",e)},expression:\"CertainPromotion.code\"}})],1),r._v(\" \"),i(\"div\",{staticClass:\"inner pull-right\"},[i(\"p\",[r._v(\"停用：\")]),r._v(\" \"),i(\"el-radio\",{attrs:{label:\"0\"},model:{value:r.CertainPromotion.is_halt,callback:function(e){r.$set(r.CertainPromotion,\"is_halt\",e)},expression:\"CertainPromotion.is_halt\"}},[r._v(\"是\")]),r._v(\" \"),i(\"el-radio\",{attrs:{label:\"1\"},model:{value:r.CertainPromotion.is_halt,callback:function(e){r.$set(r.CertainPromotion,\"is_halt\",e)},expression:\"CertainPromotion.is_halt\"}},[r._v(\"否\")])],1)]),r._v(\" \"),i(\"div\",{staticClass:\"innerbox\"},[i(\"div\",{staticClass:\"inner pull-left\"},[i(\"p\",[r._v(\"描述：\"),i(\"i\",{staticClass:\"red\"},[r._v(\"*\")])]),r._v(\" \"),i(\"el-input\",{staticStyle:{width:\"70%\"},attrs:{placeholder:\"请输入内容\"},model:{value:r.CertainPromotion.descript,callback:function(e){r.$set(r.CertainPromotion,\"descript\",e)},expression:\"CertainPromotion.descript\"}})],1),r._v(\" \"),i(\"div\",{staticClass:\"inner pull-right\"},[i(\"p\",[r._v(\"英文描述：\"),i(\"i\",{staticClass:\"red\"},[r._v(\"*\")])]),r._v(\" \"),i(\"el-input\",{staticStyle:{width:\"70%\"},attrs:{placeholder:\"请输入内容\"},model:{value:r.CertainPromotion.descript_en,callback:function(e){r.$set(r.CertainPromotion,\"descript_en\",e)},expression:\"CertainPromotion.descript_en\"}})],1)]),r._v(\" \"),i(\"div\",{staticClass:\"innerbox\"},[i(\"p\",[r._v(\"说明：\"),i(\"i\",{staticClass:\"red\"},[r._v(\"*\")])]),r._v(\" \"),i(\"el-input\",{staticStyle:{width:\"85.6%\",\"max-height\":\"100px\",\"vertical-align\":\"top\"},attrs:{type:\"textarea\",placeholder:\"请输入内容\"},model:{value:r.CertainPromotion.remark,callback:function(e){r.$set(r.CertainPromotion,\"remark\",e)},expression:\"CertainPromotion.remark\"}})],1),r._v(\" \"),i(\"div\",{staticClass:\"innerbox\"},[i(\"div\",{staticClass:\"inner pull-left\"},[i(\"p\",[r._v(\"开始时间：\"),i(\"i\",{staticClass:\"red\"},[r._v(\"*\")])]),r._v(\" \"),i(\"el-date-picker\",{staticStyle:{width:\"70%\"},attrs:{type:\"date\",placeholder:\"选择日期\"},model:{value:r.CertainPromotion.date_begin,callback:function(e){r.$set(r.CertainPromotion,\"date_begin\",e)},expression:\"CertainPromotion.date_begin\"}})],1),r._v(\" \"),i(\"div\",{staticClass:\"inner pull-right\"},[i(\"p\",[r._v(\"结束时间：\"),i(\"i\",{staticClass:\"red\"},[r._v(\"*\")])]),r._v(\" \"),i(\"el-date-picker\",{staticStyle:{width:\"70%\"},attrs:{type:\"date\",placeholder:\"选择日期\"},model:{value:r.CertainPromotion.date_end,callback:function(e){r.$set(r.CertainPromotion,\"date_end\",e)},expression:\"CertainPromotion.date_end\"}})],1)]),r._v(\" \"),i(\"div\",{staticClass:\"innerbox\"},[i(\"div\",{staticClass:\"inner pull-left\"},[i(\"p\",[r._v(\"协议单位计划：\"),i(\"i\",{staticClass:\"red\"},[r._v(\"*\")])]),r._v(\" \"),i(\"el-select\",{staticStyle:{width:\"70%\"},attrs:{filterable:\"\",placeholder:\"请选择\"},model:{value:r.CertainPromotion.card_type,callback:function(e){r.$set(r.CertainPromotion,\"card_type\",e)},expression:\"CertainPromotion.card_type\"}},r._l(r.CardTypeTree,function(e,t){return i(\"el-option\",{key:t,attrs:{label:e.descript,value:e.code}})}),1)],1),r._v(\" \"),i(\"div\",{staticClass:\"inner pull-right\"},[i(\"p\",[r._v(\"VIP等级：\")]),r._v(\" \"),i(\"el-select\",{staticStyle:{width:\"70%\"},attrs:{filterable:\"\",placeholder:\"请选择\"},on:{focus:function(e){return r.get_card_level_tree()}},model:{value:r.CertainPromotion.card_level,callback:function(e){r.$set(r.CertainPromotion,\"card_level\",e)},expression:\"CertainPromotion.card_level\"}},r._l(r.CardLevelTree,function(e,t){return i(\"el-option\",{key:t,attrs:{label:e.descript,value:e.code}})}),1)],1)]),r._v(\" \"),i(\"div\",{staticClass:\"innerbox\"},[i(\"div\",{staticClass:\"inner pull-left\"},[i(\"p\",[r._v(\"适用酒店：\")]),r._v(\" \"),i(\"el-input\",{staticStyle:{width:\"70%\"},attrs:{placeholder:\"请输入内容\"},model:{value:r.CertainPromotion.hotel,callback:function(e){r.$set(r.CertainPromotion,\"hotel\",e)},expression:\"CertainPromotion.hotel\"}})],1),r._v(\" \"),i(\"div\",{staticClass:\"inner pull-right\"},[i(\"p\",[r._v(\"排序：\")]),r._v(\" \"),i(\"el-input\",{staticStyle:{width:\"70%\"},attrs:{placeholder:\"请输入内容\"},model:{value:r.sort,callback:function(e){r.sort=e},expression:\"sort\"}})],1)]),r._v(\" \"),i(\"div\",{staticClass:\"innerbox\"},[i(\"div\",{staticClass:\"inner pull-left\"},[i(\"p\",[r._v(\"触发方式：\"),i(\"i\",{staticClass:\"red\"},[r._v(\"*\")])]),r._v(\" \"),i(\"el-select\",{staticStyle:{width:\"70%\"},attrs:{filterable:\"\",placeholder:\"请选择\"},model:{value:r.CertainPromotion.trigger_way,callback:function(e){r.$set(r.CertainPromotion,\"trigger_way\",e)},expression:\"CertainPromotion.trigger_way\"}},r._l(r.trigger_wayArr,function(e,t){return i(\"el-option\",{key:t,attrs:{label:e.descript,value:e.code}})}),1)],1),r._v(\" \"),i(\"div\",{staticClass:\"inner pull-right\"},[i(\"p\",[r._v(\"奖励方式：\"),i(\"i\",{staticClass:\"red\"},[r._v(\"*\")])]),r._v(\" \"),i(\"el-select\",{staticStyle:{width:\"70%\"},attrs:{filterable:\"\",placeholder:\"请选择\"},model:{value:r.CertainPromotion.target_way,callback:function(e){r.$set(r.CertainPromotion,\"target_way\",e)},expression:\"CertainPromotion.target_way\"}},r._l(r.target_wayArr,function(e,t){return i(\"el-option\",{key:t,attrs:{label:e.descript,value:e.code}})}),1)],1)]),r._v(\" \"),i(\"div\",{staticClass:\"innerbox\"},[i(\"div\",{staticClass:\"inner pull-left\"},[i(\"p\",[r._v(\"奖励对象：\"),i(\"i\",{staticClass:\"red\"},[r._v(\"*\")])]),r._v(\" \"),i(\"el-select\",{staticStyle:{width:\"70%\"},attrs:{filterable:\"\",placeholder:\"请选择\"},model:{value:r.CertainPromotion.target_member,callback:function(e){r.$set(r.CertainPromotion,\"target_member\",e)},expression:\"CertainPromotion.target_member\"}},r._l(r.target_memberArr,function(e,t){return i(\"el-option\",{key:t,attrs:{label:e.descript,value:e.code}})}),1)],1),r._v(\" \"),i(\"div\",{staticClass:\"inner pull-right\"},[i(\"p\",[r._v(\"奖励金额：\"),i(\"i\",{staticClass:\"red\"},[r._v(\"*\")])]),r._v(\" \"),i(\"el-input\",{staticStyle:{width:\"70%\"},attrs:{placeholder:\"请输入内容\"},model:{value:r.CertainPromotion.target_number,callback:function(e){r.$set(r.CertainPromotion,\"target_number\",e)},expression:\"CertainPromotion.target_number\"}})],1)]),r._v(\" \"),r.salesNewadd?i(\"div\",{staticClass:\"CancleAndSave pull-right\",staticStyle:{margin:\"20px 0\"}},[i(\"el-button\",{attrs:{type:\"primary\"},on:{click:function(e){return r.add_card_base()}}},[r._v(\"保存\")])],1):i(\"div\",{staticClass:\"CancleAndSave pull-right\",staticStyle:{margin:\"20px 0\"}},[i(\"el-button\",{staticStyle:{\"background-color\":\"#68819E\"},attrs:{type:\"primary\"},on:{click:function(e){return r.remove_card_promotion_info(r.CertainPromotion.id)}}},[r._v(\"删除\")]),r._v(\" \"),i(\"el-button\",{attrs:{type:\"primary\"},on:{click:function(e){return r.update_card_promotion_info(r.CertainPromotion.id)}}},[r._v(\"保存\")])],1)])])],1)},staticRenderFns:[function(){var e=this,t=e.$createElement,r=e._self._c||t;return r(\"thead\",[r(\"tr\",[r(\"th\",[e._v(\"编号\")]),e._v(\" \"),r(\"th\",[e._v(\"代码\")]),e._v(\" \"),r(\"th\",[e._v(\"描述\")]),e._v(\" \"),r(\"th\",[e._v(\"开始日期\")]),e._v(\" \"),r(\"th\",[e._v(\"结束日期\")]),e._v(\" \"),r(\"th\",[e._v(\"协议单位计划\")]),e._v(\" \"),r(\"th\",[e._v(\"VIP等级\")]),e._v(\" \"),r(\"th\",[e._v(\"触发方式\")]),e._v(\" \"),r(\"th\",[e._v(\"奖励方式\")]),e._v(\" \"),r(\"th\",[e._v(\"奖励\")]),e._v(\" \"),r(\"th\",[e._v(\"停用\")]),e._v(\" \"),r(\"th\",[e._v(\"排序\")]),e._v(\" \"),r(\"th\",[e._v(\"用户\")]),e._v(\" \"),r(\"th\",[e._v(\"修改时间\")])])])}]};var s=r(\"VU/8\")(a,n,!1,function(e){r(\"+bZw\"),r(\"n5RY\")},\"data-v-73eaeb18\",null);t.default=s.exports},n5RY:function(e,t){}});"}